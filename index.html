<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>IA Image Upscaler - GitHub Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/upscaler@latest/dist/browser/umd/upscaler.min.js"></script>
    
    <style>
        :root { --primary: #6e5494; --bg: #f6f8fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .card { background: white; border: 1px solid #d1d5da; border-radius: 6px; padding: 24px; width: 100%; max-width: 800px; box-shadow: 0 8px 24px rgba(149,157,165,0.2); }
        .drop-zone { border: 2px dashed #0366d6; border-radius: 6px; padding: 40px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: 0.3s; }
        .drop-zone:hover { background: #f1f8ff; }
        img { max-width: 100%; margin-top: 10px; border-radius: 4px; border: 1px solid #eee; }
        button { background-color: #2ea44f; color: white; border: 1px solid rgba(27,31,35,0.15); border-radius: 6px; padding: 10px 20px; font-weight: 600; cursor: pointer; width: 100%; font-size: 16px; }
        button:disabled { background-color: #94d3a2; cursor: wait; }
        .result-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        #loader { display: none; color: #0366d6; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>üöÄ IA Image Upscaler (Local)</h2>
    <p>Cette IA augmente la r√©solution de l'image (x2) directement dans votre navigateur.</p>
    
    <div class="drop-zone" id="dropZone">
        Cliquer ou glisser une image ici (PNG, JPG)
        <input type="file" id="fileInput" hidden accept="image/*">
    </div>

    <button id="upscaleBtn" style="display: none;">Am√©liorer la qualit√©</button>
    <div id="loader">L'IA r√©fl√©chit... (cela peut prendre 10-30 secondes)</div>

    <div class="result-container">
        <div>
            <p>Original :</p>
            <img id="inputImg">
        </div>
        <div>
            <p>R√©sultat IA :</p>
            <img id="outputImg">
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/upscaler@0.14.0/dist/browser/umd/upscaler.min.js"></script>

<script>
    // Correction de l'initialisation
    // On attend que la page soit totalement pr√™te
    window.onload = function() {
        try {
            // On v√©rifie si la biblioth√®que est bien charg√©e
            if (typeof Upscaler === 'undefined') {
                throw new Error("La biblioth√®que Upscaler n'est pas charg√©e. V√©rifiez votre connexion.");
            }

            const upscaler = new Upscaler();
            console.log("IA Initialis√©e avec succ√®s !");

            const fileInput = document.getElementById('fileInput');
            const upscaleBtn = document.getElementById('upscaleBtn');
            const inputImg = document.getElementById('inputImg');
            const outputImg = document.getElementById('outputImg');
            const loader = document.getElementById('loader');

            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        inputImg.src = event.target.result;
                        upscaleBtn.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            };

            upscaleBtn.onclick = async () => {
                upscaleBtn.disabled = true;
                loader.style.display = 'block';
                loader.innerText = "L'IA analyse les pixels...";

                try {
                    // On demande explicitement le mod√®le par d√©faut
                    const upscaledImage = await upscaler.upscale(inputImg.src);
                    outputImg.src = upscaledImage;
                    loader.innerText = "Termin√© !";
                } catch (err) {
                    console.error(err);
                    alert("Erreur IA : " + err.message);
                    loader.innerText = "Erreur de traitement.";
                } finally {
                    upscaleBtn.disabled = false;
                }
            };
        } catch (e) {
            console.error("Erreur au d√©marrage :", e);
            document.getElementById('loader').style.display = 'block';
            document.getElementById('loader').innerText = "Erreur d'initialisation : " + e.message;
        }
    };
</script>

</body>
</html>
